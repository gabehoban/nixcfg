{"annotations": {"list": [{"builtIn": 1, "datasource": "-- Grafana --", "enable": true, "hide": true, "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations & Alerts", "type": "dashboard"}]}, "editable": true, "gnetId": null, "graphTooltip": 0, "id": null, "links": [], "panels": [{"collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 0}, "id": 20, "panels": [], "title": "Attack Indicators", "type": "row"}, {"datasource": "Loki", "description": "IPs that are scanning multiple ports", "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "custom": {"align": "auto", "displayMode": "auto", "inspect": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 10}, {"color": "red", "value": 20}]}}}, "gridPos": {"h": 8, "w": 12, "x": 0, "y": 1}, "id": 1, "options": {"footer": {"fields": "", "reducer": ["sum"], "show": false}, "showHeader": true, "sortBy": [{"desc": true, "displayName": "Unique Ports"}]}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "topk(10, count by (src_ip) (count_over_time({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):DROP:(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" | regexp \"(?P<src_ip>\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+):(?P<src_port>[0-9]+)->\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+:(?P<dst_port>[0-9]+)\" | __error__=\"\" [1h])) by (dst_port))", "queryType": "instant", "refId": "A"}], "title": "Potential Port Scanners (Last Hour)", "transformations": [{"id": "labelsToFields", "options": {"keepLabels": ["src_ip"], "mode": "columns"}}, {"id": "organize", "options": {"excludeByName": {}, "indexByName": {}, "renameByName": {"Value #A": "Unique Ports", "src_ip": "Source IP"}}}], "type": "table"}, {"datasource": "Loki", "description": "IPs with unusually high drop rates", "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "custom": {"align": "auto", "displayMode": "auto", "inspect": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 100}, {"color": "red", "value": 500}]}}}, "gridPos": {"h": 8, "w": 12, "x": 12, "y": 1}, "id": 2, "options": {"footer": {"fields": "", "reducer": ["sum"], "show": false}, "showHeader": true, "sortBy": [{"desc": true, "displayName": "Drop Count"}]}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "topk(10, sum by (src_ip) (count_over_time({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):DROP:(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" | regexp \"(?P<src_ip>\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+)\" [10m])))", "queryType": "instant", "refId": "A"}], "title": "High Volume Attackers (Last 10 Minutes)", "transformations": [{"id": "labelsToFields", "options": {"keepLabels": ["src_ip"], "mode": "columns"}}, {"id": "organize", "options": {"excludeByName": {}, "indexByName": {}, "renameByName": {"Value #A": "Drop Count", "src_ip": "Source IP"}}}], "type": "table"}, {"datasource": "Loki", "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "lineInterpolation": "linear", "lineWidth": 2, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false, "stacking": {"group": "A", "mode": "none"}, "thresholdsStyle": {"mode": "off"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}}, "gridPos": {"h": 8, "w": 24, "x": 0, "y": 9}, "id": 3, "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "sum(rate({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):DROP:(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" [$__interval]))", "queryType": "range", "refId": "A", "legendFormat": "Total Drops"}, {"datasource": "Loki", "expr": "sum(rate({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):DROP:(?P<src_dst>[^:]+):(?P<service>[^:]+):FLOOD\\\\]\" [$__interval]))", "queryType": "range", "refId": "B", "legendFormat": "Flood Attacks"}, {"datasource": "Loki", "expr": "sum(rate({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):DROP:(?P<src_dst>[^:]+):(?P<service>[^:]+):INVALID\\\\]\" [$__interval]))", "queryType": "range", "refId": "C", "legendFormat": "Invalid Packets"}], "title": "Attack Pattern Timeline", "type": "timeseries"}, {"collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 17}, "id": 21, "panels": [], "title": "Service-Specific Threats", "type": "row"}, {"datasource": "Loki", "description": "SSH brute force attempts", "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "custom": {"align": "auto", "displayMode": "auto", "inspect": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 5}, {"color": "red", "value": 10}]}}}, "gridPos": {"h": 8, "w": 12, "x": 0, "y": 18}, "id": 4, "options": {"footer": {"fields": "", "reducer": ["sum"], "show": false}, "showHeader": true, "sortBy": [{"desc": true, "displayName": "Attempts"}]}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "topk(10, sum by (src_ip) (count_over_time({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):DROP:(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" | regexp \"(?P<src_ip>\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+):(?P<src_port>[0-9]+)->\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+:22\" [1h])))", "queryType": "instant", "refId": "A"}], "title": "SSH Brute Force Attempts", "transformations": [{"id": "labelsToFields", "options": {"keepLabels": ["src_ip"], "mode": "columns"}}, {"id": "organize", "options": {"excludeByName": {}, "indexByName": {}, "renameByName": {"Value #A": "Attempts", "src_ip": "Source IP"}}}], "type": "table"}, {"datasource": "Loki", "description": "Web service attacks (80, 443, 8080)", "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "custom": {"align": "auto", "displayMode": "auto", "inspect": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 50}, {"color": "red", "value": 100}]}}}, "gridPos": {"h": 8, "w": 12, "x": 12, "y": 18}, "id": 5, "options": {"footer": {"fields": "", "reducer": ["sum"], "show": false}, "showHeader": true, "sortBy": [{"desc": true, "displayName": "Attempts"}]}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "topk(10, sum by (src_ip, dst_port) (count_over_time({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):DROP:(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" | regexp \"(?P<src_ip>\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+):(?P<src_port>[0-9]+)->\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+:(?P<dst_port>80|443|8080)\" [1h])))", "queryType": "instant", "refId": "A"}], "title": "Web Service Attack Attempts", "transformations": [{"id": "labelsToFields", "options": {"keepLabels": ["src_ip", "dst_port"], "mode": "columns"}}, {"id": "organize", "options": {"excludeByName": {}, "indexByName": {}, "renameByName": {"Value #A": "Attempts", "src_ip": "Source IP", "dst_port": "Target Port"}}}], "type": "table"}, {"collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 26}, "id": 22, "panels": [], "title": "Attack Classification", "type": "row"}, {"datasource": "Loki", "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"hideFrom": {"legend": false, "tooltip": false, "viz": false}}, "mappings": []}}, "gridPos": {"h": 8, "w": 12, "x": 0, "y": 27}, "id": 6, "options": {"displayLabels": ["percent"], "legend": {"displayMode": "table", "placement": "right", "values": ["value", "percent"]}, "pieType": "donut", "reduceOptions": {"calcs": ["count"], "fields": "", "values": false}, "tooltip": {"mode": "single"}}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "sum by (reason) (count_over_time({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):DROP:(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" [$__interval]))", "queryType": "range", "refId": "A"}], "title": "Drop Reasons Distribution", "type": "piechart"}, {"datasource": "Loki", "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"hideFrom": {"legend": false, "tooltip": false, "viz": false}}, "mappings": []}}, "gridPos": {"h": 8, "w": 12, "x": 12, "y": 27}, "id": 7, "options": {"displayLabels": ["percent"], "legend": {"displayMode": "table", "placement": "right", "values": ["value", "percent"]}, "pieType": "donut", "reduceOptions": {"calcs": ["count"], "fields": "", "values": false}, "tooltip": {"mode": "single"}}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "sum by (attack_type) (count_over_time({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):DROP:(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" | regexp \"(?P<src_ip>\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+):(?P<src_port>[0-9]+)->\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+:(?P<dst_port>[0-9]+)\" | label_format attack_type=\"{{if .dst_port | eq \\\"22\\\"}}SSH Attack{{else if .dst_port | eq \\\"80\\\"}}HTTP Attack{{else if .dst_port | eq \\\"443\\\"}}HTTPS Attack{{else if .dst_port | eq \\\"53\\\"}}DNS Attack{{else if .dst_port | eq \\\"445\\\"}}SMB Attack{{else if .dst_port | eq \\\"3389\\\"}}RDP Attack{{else}}Other{{end}}\" [$__interval]))", "queryType": "range", "refId": "A"}], "title": "Attack Types by Target Port", "type": "piechart"}], "refresh": "30s", "schemaVersion": 36, "style": "dark", "tags": ["mikrotik", "security", "threats"], "templating": {"list": []}, "time": {"from": "now-6h", "to": "now"}, "timepicker": {}, "timezone": "", "title": "Mikrotik Security Threats", "uid": "mikrotik-security", "version": 1, "weekStart": ""}
