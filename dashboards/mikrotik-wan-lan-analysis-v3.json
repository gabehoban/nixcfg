{"annotations": {"list": [{"builtIn": 1, "datasource": "-- Grafana --", "enable": true, "hide": true, "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations & Alerts", "type": "dashboard"}]}, "editable": true, "gnetId": null, "graphTooltip": 0, "id": null, "links": [], "panels": [{"collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 0}, "id": 20, "panels": [], "title": "LAN Traffic (10.0.0.0/8)", "type": "row"}, {"datasource": "Loki", "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "lineInterpolation": "linear", "lineWidth": 2, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false, "stacking": {"group": "A", "mode": "none"}, "thresholdsStyle": {"mode": "off"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}}, "gridPos": {"h": 8, "w": 12, "x": 0, "y": 1}, "id": 1, "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "sum by (action) (rate({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):(?P<action>[^:]+):(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" | regexp \"(?P<src_ip>10\\\\.[0-9]+\\\\.[0-9]+\\\\.[0-9]+)\" [$__interval]))", "queryType": "range", "refId": "A"}], "title": "LAN Event Rate by Action", "type": "timeseries"}, {"datasource": "Loki", "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "red", "value": 80}]}}}, "gridPos": {"h": 8, "w": 12, "x": 12, "y": 1}, "id": 2, "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "sum(count_over_time({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):DROP:(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" | regexp \"(?P<src_ip>10\\\\.[0-9]+\\\\.[0-9]+\\\\.[0-9]+)\" [1h]))", "queryType": "instant", "refId": "A"}], "title": "LAN Drops (Last Hour)", "type": "stat"}, {"datasource": "Loki", "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "custom": {"align": "auto", "displayMode": "auto", "inspect": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}}}, "gridPos": {"h": 8, "w": 12, "x": 0, "y": 9}, "id": 3, "options": {"footer": {"fields": "", "reducer": ["sum"], "show": false}, "showHeader": true, "sortBy": [{"desc": true, "displayName": "Count"}]}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "topk(10, sum by (src_ip) (count_over_time({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):DROP:(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" | regexp \"(?P<src_ip>10\\\\.[0-9]+\\\\.[0-9]+\\\\.[0-9]+):(?:[0-9]+)->\" [1h])))", "queryType": "instant", "refId": "A"}], "title": "Top 10 Blocked LAN IPs", "transformations": [{"id": "labelsToFields", "options": {"keepLabels": ["src_ip"], "mode": "columns"}}, {"id": "organize", "options": {"excludeByName": {}, "indexByName": {}, "renameByName": {"Value #A": "Count", "src_ip": "Source IP"}}}], "type": "table"}, {"datasource": "Loki", "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "custom": {"align": "auto", "displayMode": "auto", "inspect": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}}}, "gridPos": {"h": 8, "w": 12, "x": 12, "y": 9}, "id": 4, "options": {"footer": {"fields": "", "reducer": ["sum"], "show": false}, "showHeader": true, "sortBy": [{"desc": true, "displayName": "Count"}]}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "topk(10, sum by (service) (count_over_time({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):DROP:(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" | regexp \"(?P<src_ip>10\\\\.[0-9]+\\\\.[0-9]+\\\\.[0-9]+)\" [1h])))", "queryType": "instant", "refId": "A"}], "title": "Top 10 Blocked LAN Services", "transformations": [{"id": "labelsToFields", "options": {"keepLabels": ["service"], "mode": "columns"}}, {"id": "organize", "options": {"excludeByName": {}, "indexByName": {}, "renameByName": {"Value #A": "Count", "service": "Service"}}}], "type": "table"}, {"collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 17}, "id": 21, "panels": [], "title": "WAN Traffic (Non-10.0.0.0/8)", "type": "row"}, {"datasource": "Loki", "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "lineInterpolation": "linear", "lineWidth": 2, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false, "stacking": {"group": "A", "mode": "none"}, "thresholdsStyle": {"mode": "off"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}}, "gridPos": {"h": 8, "w": 12, "x": 0, "y": 18}, "id": 5, "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "sum by (action) (rate({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):(?P<action>[^:]+):(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" | regexp \"(?P<src_ip>\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+)\" | regexp \"(?P<wan_ip>(?!10\\\\.)[0-9]+\\\\.[0-9]+\\\\.[0-9]+\\\\.[0-9]+)\" [$__interval]))", "queryType": "range", "refId": "A"}], "title": "WAN Event Rate by Action", "type": "timeseries"}, {"datasource": "Loki", "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "red", "value": 80}]}}}, "gridPos": {"h": 8, "w": 12, "x": 12, "y": 18}, "id": 6, "options": {"colorMode": "value", "graphMode": "area", "justifyMode": "auto", "orientation": "auto", "reduceOptions": {"calcs": ["lastNotNull"], "fields": "", "values": false}, "textMode": "auto"}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "sum(count_over_time({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):DROP:(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" | regexp \"(?P<src_ip>\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+)\" | regexp \"(?P<wan_ip>(?!10\\\\.)[0-9]+\\\\.[0-9]+\\\\.[0-9]+\\\\.[0-9]+)\" [1h]))", "queryType": "instant", "refId": "A"}], "title": "WAN Drops (Last Hour)", "type": "stat"}, {"datasource": "Loki", "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "custom": {"align": "auto", "displayMode": "auto", "inspect": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}}}, "gridPos": {"h": 8, "w": 12, "x": 0, "y": 26}, "id": 7, "options": {"footer": {"fields": "", "reducer": ["sum"], "show": false}, "showHeader": true, "sortBy": [{"desc": true, "displayName": "Count"}]}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "topk(10, sum by (src_ip) (count_over_time({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):DROP:(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" | regexp \"(?P<src_ip>(?!10\\\\.)[0-9]+\\\\.[0-9]+\\\\.[0-9]+\\\\.[0-9]+):(?:[0-9]+)->\" [1h])))", "queryType": "instant", "refId": "A"}], "title": "Top 10 Blocked WAN IPs", "transformations": [{"id": "labelsToFields", "options": {"keepLabels": ["src_ip"], "mode": "columns"}}, {"id": "organize", "options": {"excludeByName": {}, "indexByName": {}, "renameByName": {"Value #A": "Count", "src_ip": "Source IP"}}}], "type": "table"}, {"datasource": "Loki", "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "custom": {"align": "auto", "displayMode": "auto", "inspect": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}}}, "gridPos": {"h": 8, "w": 12, "x": 12, "y": 26}, "id": 8, "options": {"footer": {"fields": "", "reducer": ["sum"], "show": false}, "showHeader": true, "sortBy": [{"desc": true, "displayName": "Count"}]}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "topk(10, sum by (service) (count_over_time({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):DROP:(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" | regexp \"(?P<src_ip>\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+)\" | regexp \"(?P<wan_ip>(?!10\\\\.)[0-9]+\\\\.[0-9]+\\\\.[0-9]+\\\\.[0-9]+)\" [1h])))", "queryType": "instant", "refId": "A"}], "title": "Top 10 Blocked WAN Services", "transformations": [{"id": "labelsToFields", "options": {"keepLabels": ["service"], "mode": "columns"}}, {"id": "organize", "options": {"excludeByName": {}, "indexByName": {}, "renameByName": {"Value #A": "Count", "service": "Service"}}}], "type": "table"}, {"collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 34}, "id": 22, "panels": [], "title": "Overall Statistics", "type": "row"}, {"datasource": "Loki", "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"hideFrom": {"legend": false, "tooltip": false, "viz": false}}, "mappings": []}}, "gridPos": {"h": 8, "w": 8, "x": 0, "y": 35}, "id": 9, "options": {"displayLabels": ["percent"], "legend": {"displayMode": "table", "placement": "right", "values": ["value", "percent"]}, "pieType": "donut", "reduceOptions": {"calcs": ["count"], "fields": "", "values": false}, "tooltip": {"mode": "single"}}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "sum by (type) (count_over_time({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):(?P<action>[^:]+):(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" | regexp \"(?P<src_ip>\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+)\"  | __error__=\"\" | label_format is_lan=\"{{.src_ip}}\" | regexp \"(?P<is_lan>10\\\\.[0-9]+\\\\.[0-9]+\\\\.[0-9]+)\" | label_format type=\"LAN\" [$__interval])) or sum by (type) (count_over_time({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):(?P<action>[^:]+):(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" | regexp \"(?P<src_ip>\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+)\"  | __error__=\"\" | label_format is_lan=\"{{.src_ip}}\" | regexp \"(?P<is_lan>(?!10\\\\.)[0-9]+\\\\.[0-9]+\\\\.[0-9]+\\\\.[0-9]+)\" | label_format type=\"WAN\" [$__interval]))", "queryType": "range", "refId": "A"}], "title": "LAN vs WAN Traffic Distribution", "type": "piechart"}, {"datasource": "Loki", "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "lineInterpolation": "linear", "lineWidth": 2, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false, "stacking": {"group": "A", "mode": "normal"}, "thresholdsStyle": {"mode": "off"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}}, "gridPos": {"h": 8, "w": 16, "x": 8, "y": 35}, "id": 10, "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "sum by (type) (rate({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):(?P<action>[^:]+):(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" | regexp \"(?P<src_ip>10\\\\.[0-9]+\\\\.[0-9]+\\\\.[0-9]+)\" | label_format type=\"LAN\" [$__interval])) or sum by (type) (rate({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):(?P<action>[^:]+):(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" | regexp \"(?P<src_ip>\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+)\" | regexp \"(?P<wan_ip>(?!10\\\\.)[0-9]+\\\\.[0-9]+\\\\.[0-9]+\\\\.[0-9]+)\" | label_format type=\"WAN\" [$__interval]))", "queryType": "range", "refId": "A"}], "title": "LAN vs WAN Event Rate", "type": "timeseries"}], "refresh": "30s", "schemaVersion": 36, "style": "dark", "tags": ["mikrotik", "firewall", "wan", "lan"], "templating": {"list": []}, "time": {"from": "now-6h", "to": "now"}, "timepicker": {}, "timezone": "", "title": "Mikrotik WAN vs LAN Analysis", "uid": "mikrotik-wan-lan-v3", "version": 1, "weekStart": ""}
