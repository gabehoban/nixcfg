{"annotations": {"list": [{"builtIn": 1, "datasource": "-- Grafana --", "enable": true, "hide": true, "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations & Alerts", "type": "dashboard"}]}, "editable": true, "gnetId": null, "graphTooltip": 0, "id": null, "links": [], "panels": [{"datasource": "Loki", "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"hideFrom": {"legend": false, "tooltip": false, "viz": false}}, "mappings": []}}, "gridPos": {"h": 8, "w": 8, "x": 0, "y": 0}, "id": 1, "options": {"displayLabels": ["percent"], "legend": {"displayMode": "table", "placement": "right", "values": ["value", "percent"]}, "pieType": "donut", "reduceOptions": {"calcs": ["count"], "fields": "", "values": false}, "tooltip": {"mode": "single"}}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "sum by (action) (count_over_time({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):(?P<action>[^:]+):(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" [$__interval]))", "queryType": "range", "refId": "A"}], "title": "Actions Distribution", "type": "piechart"}, {"datasource": "Loki", "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"hideFrom": {"legend": false, "tooltip": false, "viz": false}}, "mappings": []}}, "gridPos": {"h": 8, "w": 8, "x": 8, "y": 0}, "id": 2, "options": {"displayLabels": ["percent"], "legend": {"displayMode": "table", "placement": "right", "values": ["value", "percent"]}, "pieType": "donut", "reduceOptions": {"calcs": ["count"], "fields": "", "values": false}, "tooltip": {"mode": "single"}}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "sum by (chain) (count_over_time({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):(?P<action>[^:]+):(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" [$__interval]))", "queryType": "range", "refId": "A"}], "title": "Events by Chain", "type": "piechart"}, {"datasource": "Loki", "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"hideFrom": {"legend": false, "tooltip": false, "viz": false}}, "mappings": []}}, "gridPos": {"h": 8, "w": 8, "x": 16, "y": 0}, "id": 3, "options": {"displayLabels": ["percent"], "legend": {"displayMode": "table", "placement": "right", "values": ["value", "percent"]}, "pieType": "donut", "reduceOptions": {"calcs": ["count"], "fields": "", "values": false}, "tooltip": {"mode": "single"}}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "sum by (reason) (count_over_time({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):(?P<action>[^:]+):(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" [$__interval]))", "queryType": "range", "refId": "A"}], "title": "Events by Reason", "type": "piechart"}, {"datasource": "Loki", "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "lineInterpolation": "linear", "lineWidth": 2, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false, "stacking": {"group": "A", "mode": "none"}, "thresholdsStyle": {"mode": "off"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "red", "value": 80}]}, "unit": "short"}}, "gridPos": {"h": 8, "w": 12, "x": 0, "y": 8}, "id": 4, "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "sum by (action) (rate({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):(?P<action>[^:]+):(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" [$__interval]))", "queryType": "range", "refId": "A"}], "title": "Event Rate by Action", "type": "timeseries"}, {"datasource": "Loki", "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "lineInterpolation": "linear", "lineWidth": 2, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false, "stacking": {"group": "A", "mode": "normal"}, "thresholdsStyle": {"mode": "off"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}}, "gridPos": {"h": 8, "w": 12, "x": 12, "y": 8}, "id": 5, "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "sum by (chain) (rate({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):(?P<action>[^:]+):(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" [$__interval]))", "queryType": "range", "refId": "A"}], "title": "Event Rate by Chain (Stacked)", "type": "timeseries"}, {"datasource": "Loki", "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "custom": {"align": "auto", "displayMode": "auto", "inspect": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}, {"color": "yellow", "value": 50}, {"color": "red", "value": 100}]}}}, "gridPos": {"h": 8, "w": 12, "x": 0, "y": 16}, "id": 6, "options": {"footer": {"fields": "", "reducer": ["sum"], "show": false}, "showHeader": true, "sortBy": [{"desc": true, "displayName": "Count"}]}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "topk(10, sum by (src_ip) (count_over_time({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):DROP:(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" | regexp \"(?P<src_ip>\\\\d+\\\\.\\\\d+\\\\.\\\\d+\\\\.\\\\d+):(?:[0-9]+)->\" [1h])))", "queryType": "instant", "refId": "A"}], "title": "Top 10 Dropped Source IPs (Last Hour)", "transformations": [{"id": "labelsToFields", "options": {"keepLabels": ["src_ip"], "mode": "columns"}}, {"id": "organize", "options": {"excludeByName": {}, "indexByName": {}, "renameByName": {"Value #A": "Count", "src_ip": "Source IP"}}}], "type": "table"}, {"datasource": "Loki", "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "custom": {"align": "auto", "displayMode": "auto", "inspect": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}}}, "gridPos": {"h": 8, "w": 12, "x": 12, "y": 16}, "id": 7, "options": {"footer": {"fields": "", "reducer": ["sum"], "show": false}, "showHeader": true, "sortBy": [{"desc": true, "displayName": "Count"}]}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "sum by (src_dst, action) (count_over_time({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):(?P<action>[^:]+):(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" [1h]))", "queryType": "instant", "refId": "A"}], "title": "Traffic Flow Summary (Last Hour)", "transformations": [{"id": "labelsToFields", "options": {"keepLabels": ["src_dst", "action"], "mode": "columns"}}, {"id": "organize", "options": {"excludeByName": {}, "indexByName": {}, "renameByName": {"Value #A": "Count", "src_dst": "Source > Destination", "action": "Action"}}}], "type": "table"}, {"datasource": "Loki", "gridPos": {"h": 12, "w": 24, "x": 0, "y": 24}, "id": 8, "options": {"dedupStrategy": "none", "enableLogDetails": true, "prettifyLogMessage": false, "showCommonLabels": false, "showLabels": true, "showTime": true, "sortOrder": "Descending", "wrapLogMessage": true}, "targets": [{"datasource": "Loki", "expr": "{job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):(?P<action>[^:]+):(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\"", "queryType": "range", "refId": "A"}], "title": "Firewall Log Stream", "type": "logs"}, {"datasource": "Loki", "description": "Shows the most frequent service/protocol being blocked", "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "custom": {"align": "auto", "displayMode": "auto", "inspect": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}}}, "gridPos": {"h": 8, "w": 12, "x": 0, "y": 36}, "id": 9, "options": {"footer": {"fields": "", "reducer": ["sum"], "show": false}, "showHeader": true, "sortBy": [{"desc": true, "displayName": "Count"}]}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "topk(10, sum by (service) (count_over_time({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):DROP:(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" [1h])))", "queryType": "instant", "refId": "A"}], "title": "Top 10 Blocked Services (Last Hour)", "transformations": [{"id": "labelsToFields", "options": {"keepLabels": ["service"], "mode": "columns"}}, {"id": "organize", "options": {"excludeByName": {}, "indexByName": {}, "renameByName": {"Value #A": "Count", "service": "Service/Protocol"}}}], "type": "table"}], "refresh": "30s", "schemaVersion": 36, "style": "dark", "tags": ["mikrotik", "firewall", "security"], "templating": {"list": []}, "time": {"from": "now-6h", "to": "now"}, "timepicker": {}, "timezone": "", "title": "Mikrotik Firewall Logs", "uid": "mikrotik-firewall-v2", "version": 1, "weekStart": ""}
