{"annotations": {"list": [{"builtIn": 1, "datasource": "-- Grafana --", "enable": true, "hide": true, "iconColor": "rgba(0, 211, 255, 1)", "name": "Annotations & Alerts", "type": "dashboard"}]}, "editable": true, "gnetId": null, "graphTooltip": 0, "id": null, "links": [], "panels": [{"datasource": "Loki", "description": "Event rate by action over time", "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "lineInterpolation": "linear", "lineWidth": 2, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false, "stacking": {"group": "A", "mode": "none"}, "thresholdsStyle": {"mode": "off"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}}, "gridPos": {"h": 8, "w": 24, "x": 0, "y": 0}, "id": 1, "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "sum by (action) (rate({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):(?P<action>[^:]+):(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" [1h]))", "queryType": "range", "refId": "A"}], "title": "Hourly Event Rate by Action", "type": "timeseries"}, {"datasource": "Loki", "description": "Heatmap showing drop events by hour", "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "axisSoftMin": 0, "fillOpacity": 80, "gradientMode": "scheme", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "lineWidth": 0, "scaleDistribution": {"type": "linear"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}}}, "gridPos": {"h": 10, "w": 12, "x": 0, "y": 8}, "id": 2, "options": {"calculate": true, "cellGap": 2, "cellValues": {"decimals": 0}, "color": {"exponent": 0.5, "fill": "dark-orange", "mode": "scheme", "reverse": false, "scale": "exponential", "scheme": "Oranges", "steps": 128}, "exemplars": false, "filterValues": {"le": 1e-09}, "legend": {"show": true}, "rowsFrame": {"layout": "auto"}, "tooltip": {"show": true, "yHistogram": false}, "yAxis": {"axisPlacement": "left", "reverse": false, "unit": "short"}}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "sum by (hour) (count_over_time({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):DROP:(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" | label_format hour=\"{{__timestamp__ | date \\\"15\\\"}}\" [24h]))", "queryType": "range", "refId": "A"}], "title": "Drop Events by Hour of Day (Last 24h)", "type": "heatmap"}, {"datasource": "Loki", "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "bars", "fillOpacity": 80, "gradientMode": "none", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "lineInterpolation": "linear", "lineWidth": 1, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false, "stacking": {"group": "A", "mode": "none"}, "thresholdsStyle": {"mode": "off"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}}}, "gridPos": {"h": 10, "w": 12, "x": 12, "y": 8}, "id": 3, "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "single"}}, "targets": [{"datasource": "Loki", "expr": "sum by (day_of_week) (count_over_time({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):DROP:(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" | label_format day_of_week=\"{{__timestamp__ | date \\\"Monday\\\"}}\" [7d]))", "queryType": "range", "refId": "A"}], "title": "Drop Events by Day of Week (Last 7 Days)", "type": "timeseries"}, {"datasource": "Loki", "fieldConfig": {"defaults": {"color": {"mode": "thresholds"}, "custom": {"align": "auto", "displayMode": "auto", "inspect": false}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}}}, "gridPos": {"h": 8, "w": 12, "x": 0, "y": 18}, "id": 4, "options": {"footer": {"fields": "", "reducer": ["sum"], "show": false}, "showHeader": true, "sortBy": [{"desc": true, "displayName": "Event Count"}]}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "sum by (hour_of_day) (count_over_time({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):DROP:(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" | label_format hour_of_day=\"{{__timestamp__ | date \\\"15\\\"}}\" [24h]))", "queryType": "instant", "refId": "A"}], "title": "Busiest Hours (Last 24h)", "transformations": [{"id": "labelsToFields", "options": {"keepLabels": ["hour_of_day"], "mode": "columns"}}, {"id": "organize", "options": {"excludeByName": {}, "indexByName": {}, "renameByName": {"Value #A": "Event Count", "hour_of_day": "Hour"}}}], "type": "table"}, {"datasource": "Loki", "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"hideFrom": {"legend": false, "tooltip": false, "viz": false}}, "mappings": []}}, "gridPos": {"h": 8, "w": 12, "x": 12, "y": 18}, "id": 5, "options": {"displayLabels": ["percent"], "legend": {"displayMode": "table", "placement": "right", "values": ["value", "percent"]}, "pieType": "donut", "reduceOptions": {"calcs": ["count"], "fields": "", "values": false}, "tooltip": {"mode": "single"}}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "sum by (hour_group) (count_over_time({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):DROP:(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" | label_format hour=\"{{__timestamp__ | date \\\"15\\\"}}\" | label_format hour_group=\"{{if (.hour | eq \\\"00\\\") or (.hour | eq \\\"01\\\") or (.hour | eq \\\"02\\\") or (.hour | eq \\\"03\\\") or (.hour | eq \\\"04\\\") or (.hour | eq \\\"05\\\")}}Night (00-06){{else if (.hour | eq \\\"06\\\") or (.hour | eq \\\"07\\\") or (.hour | eq \\\"08\\\") or (.hour | eq \\\"09\\\") or (.hour | eq \\\"10\\\") or (.hour | eq \\\"11\\\")}}Morning (06-12){{else if (.hour | eq \\\"12\\\") or (.hour | eq \\\"13\\\") or (.hour | eq \\\"14\\\") or (.hour | eq \\\"15\\\") or (.hour | eq \\\"16\\\") or (.hour | eq \\\"17\\\")}}Afternoon (12-18){{else}}Evening (18-00){{end}}\" [24h]))", "queryType": "range", "refId": "A"}], "title": "Events by Time Period (Last 24h)", "type": "piechart"}, {"collapsed": false, "gridPos": {"h": 1, "w": 24, "x": 0, "y": 26}, "id": 10, "panels": [], "title": "Weekly Patterns", "type": "row"}, {"datasource": "Loki", "fieldConfig": {"defaults": {"color": {"mode": "palette-classic"}, "custom": {"axisLabel": "", "axisPlacement": "auto", "barAlignment": 0, "drawStyle": "line", "fillOpacity": 10, "gradientMode": "none", "hideFrom": {"legend": false, "tooltip": false, "viz": false}, "lineInterpolation": "linear", "lineWidth": 2, "pointSize": 5, "scaleDistribution": {"type": "linear"}, "showPoints": "never", "spanNulls": false, "stacking": {"group": "A", "mode": "none"}, "thresholdsStyle": {"mode": "off"}}, "mappings": [], "thresholds": {"mode": "absolute", "steps": [{"color": "green", "value": null}]}, "unit": "short"}}, "gridPos": {"h": 8, "w": 24, "x": 0, "y": 27}, "id": 6, "options": {"legend": {"calcs": [], "displayMode": "list", "placement": "bottom"}, "tooltip": {"mode": "multi"}}, "pluginVersion": "9.0.0", "targets": [{"datasource": "Loki", "expr": "sum by (hour) (rate({job=\"mikrotik\"} | regexp \"\\\\[(?P<chain>[^:]+):DROP:(?P<src_dst>[^:]+):(?P<service>[^:]+):(?P<reason>[^\\\\]]+)\\\\]\" | label_format hour=\"{{__timestamp__ | date \\\"15\\\"}}\" [1h]))", "queryType": "range", "refId": "A"}], "title": "Drop Events by Hour (Last 7 Days)", "type": "timeseries"}], "refresh": "1m", "schemaVersion": 36, "style": "dark", "tags": ["mikrotik", "time", "analysis"], "templating": {"list": []}, "time": {"from": "now-24h", "to": "now"}, "timepicker": {}, "timezone": "", "title": "Mikrotik Time-based Analysis", "uid": "mikrotik-time-v2", "version": 1, "weekStart": ""}
